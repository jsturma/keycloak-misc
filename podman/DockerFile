# -----------------------------------------------------------------------------
# Keycloak 26.x (Quarkus) - Podman compatible
# -----------------------------------------------------------------------------
    FROM quay.io/keycloak/keycloak:26.4.7

    # Switch to root only if we need to copy files
    USER root
    
    # Optional: custom themes / providers
    # COPY themes /opt/keycloak/themes
    # COPY providers/*.jar /opt/keycloak/providers/
    
    # Ensure correct ownership for rootless Podman
    RUN chown -R 1000:0 /opt/keycloak
    
    # Drop privileges
    USER 1000
    
    # Build Keycloak (recommended for production)
    RUN /opt/keycloak/bin/kc.sh build
    
    # Expose HTTPS only (no HTTP)
    EXPOSE 8443
    
    # Entrypoint
    ENTRYPOINT ["/opt/keycloak/bin/kc.sh"]
    CMD ["start-dev"]
    